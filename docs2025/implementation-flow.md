# 実装フロー（2025年版リプレース）

本ドキュメントは、2025年版サイトの段階的な実装手順とタスクの依存関係を定義する。Carbon Components から Tailwind CSS への移行を含む完全なリプレースを、リスクを最小化しながら実行する。

## 1. 実装戦略

### 基本方針
- **段階的実装**: 各フェーズで動作確認を行い、リスクを分散
- **並行開発**: 依存関係のないタスクは同時進行
- **段階的移行**: Carbon Components から Tailwind CSS への漸進的移行
- **データ分離優先**: マスターデータと参加情報の分離を最初に実行

### リリース戦略
1. **フェーズ1**: 基盤整備（Tailwind、型定義、データ移行）
2. **フェーズ2**: コアコンポーネントの実装（2025年版）
3. **フェーズ3**: ルーティングとページ実装
4. **フェーズ4**: 過年度ページの実装
5. **フェーズ5**: 最適化とテスト強化

## 2. フェーズ1: 基盤整備

### 2.1 Tailwind CSS 導入
**所要時間**: 1-2時間  
**依存**: なし  
**成果物**: Tailwind設定、ベースCSS

```bash
# パッケージインストール
npm install -D tailwindcss postcss autoprefixer @tailwindcss/typography
npx tailwindcss init -p
```

**タスク**:
- [x] Tailwind CSS パッケージインストール
- [x] `tailwind.config.js` 設定
- [x] `src/app.css` 作成（デザイントークン含む）
- [x] Carbon Components の段階的削除計画策定
- [x] 動作確認（簡単なスタイル適用）

### 2.2 型定義の整備
**所要時間**: 1-2時間  
**依存**: なし  
**成果物**: TypeScript型定義

**タスク**:
- [x] `src/types/stores.d.ts` 作成
  - Store, Brewery, Participation 型
- [x] `src/types/constants.ts` 作成
  - Prefecture 型の分離
- [x] 既存型定義との互換性確認
- [x] TypeScript コンパイル確認

### 2.3 データ移行スクリプト作成
**所要時間**: 2-3時間  
**依存**: 型定義  
**成果物**: 移行スクリプト、新形式JSONファイル

**タスク**:
- [x] `scripts/migrate-data.js` 作成
- [x] 既存 `stores.json` の解析
- [x] 店舗マスターの抽出（`/static/stores.json`）
- [x] 酒蔵マスターの生成（`/static/breweries.json`）
- [x] 参加情報の分離（`/static/2024/participations.json`）
- [x] 2024/2023年度データの変換（段階的）
- [x] データ整合性の検証

### 2.4 基本ユーティリティ実装
**所要時間**: 1-2時間  
**依存**: 型定義、データ移行  
**成果物**: データ処理ユーティリティ

**タスク**:
- [x] `src/lib/utils/participation.ts` 作成
  - 初参加/継続回数算出ロジック
- [x] `src/lib/data/stores.ts` 作成
  - データ結合・変換ロジック
- [x] 単体テストの作成
- [x] 動作確認

## 3. フェーズ2: コアコンポーネント実装

### 3.1 基本コンポーネント
**所要時間**: 3-4時間  
**依存**: Tailwind CSS導入  
**成果物**: Tailwind ベースのコンポーネント群

**実装順序**:
1. **Header.svelte** (1時間)
   - グローバルナビゲーション
   - Tailwind でのレスポンシブ対応
   - アクセシビリティ対応

2. **Footer.svelte** (30分)
   - 年度リンクと運営情報
   - SNS リンク

3. **SkipLink** パターン (30分)
   - フォーカス管理
   - アクセシビリティ対応

4. **Hero.svelte** (1時間)
   - メインビジュアル
   - picture 要素での画像最適化

5. **CTA.svelte** (30分)
   - 一次導線ボタン
   - フォーカスリング対応

### 3.2 店舗関連コンポーネント
**所要時間**: 4-5時間  
**依存**: 基本コンポーネント、データユーティリティ  
**成果物**: 店舗表示コンポーネント群

**実装順序**:
1. **BusinessTimeCell.svelte** (1時間)
   - ISO8601 形式の営業時間表示
   - 中断時間の対応

2. **SnsUrls.svelte** (1時間)
   - SNS リンクの条件付き表示
   - アイコン対応（テキストリンク優先）

3. **StoreCard.svelte** (1.5時間)
   - 一覧用カード表示
   - 画像遅延読込
   - バッジ表示（初参加/継続）

4. **StoreDetail.svelte** (1.5時間)
   - 詳細ページ用表示
   - 全情報の条件付きレンダリング

5. **StoreList.svelte** (1時間)
   - カード一覧のコンテナ
   - 空状態の対応

### 3.3 コンポーネント単体テスト
**所要時間**: 2-3時間  
**依存**: コンポーネント実装  
**成果物**: テストカバレッジ

**タスク**:
- [x] 各コンポーネントの基本テスト
- [x] Props のバリエーションテスト
- [x] アクセシビリティ要件のテスト
- [x] スナップショットテスト（最小限）

## 4. フェーズ3: ルーティングとページ実装

### 4.1 2025年版メインルート
**所要時間**: 4-6時間  
**依存**: コンポーネント群  
**成果物**: 2025年版の主要ページ

**実装順序**:
1. **+layout.svelte** (1時間)
   - 共通レイアウト
   - Header/Footer の配置
   - Skip link の実装

2. **+page.svelte** (トップページ) (1.5時間)
   - Hero セクション
   - 概要・参加方法
   - CTA（店舗一覧への誘導）

3. **stores/+page.svelte** (店舗一覧) (1.5時間)
   - StoreList コンポーネントの使用
   - データ取得ロジック（+page.ts）
   - プリレンダリング設定

4. **stores/[storeId]/+page.svelte** (店舗詳細) (2時間)
   - StoreDetail コンポーネントの使用
   - 404 エラーハンドリング
   - メタ情報の動的設定

### 4.2 データ取得ロジック実装
**所要時間**: 2-3時間  
**依存**: ページ実装  
**成果物**: SvelteKit load 関数群

**タスク**:
- [ ] `src/routes/+page.ts` 実装
- [ ] `src/routes/stores/+page.ts` 実装
- [ ] `src/routes/stores/[storeId]/+page.ts` 実装
- [ ] エラーハンドリング（`+error.svelte`）
- [ ] プリレンダリング設定

### 4.3 SEO・メタ情報設定
**所要時間**: 1-2時間  
**依存**: ページ実装  
**成果物**: SEO最適化

**タスク**:
- [ ] ページ別メタタグ設定
- [ ] OGP 画像の配置
- [ ] `sitemap.xml` 生成
- [ ] `robots.txt` 設定
- [ ] canonical URL 設定

## 5. フェーズ4: 過年度ページ実装

### 4.1 年度別ルーティング
**所要時間**: 3-4時間  
**依存**: 2025年版完成  
**成果物**: 過年度ページ群

**実装順序**:
1. **[year]/+layout.svelte** (1時間)
   - 年度別レイアウト
   - 年度表示の対応

2. **[year]/+page.svelte** (年度トップ) (1時間)
   - 過年度の概要表示
   - 2025版の簡素化バージョン

3. **[year]/stores/+page.svelte** (年度別一覧) (1時間)
   - 年度パラメータでのデータ切り替え

4. **[year]/stores/[storeId]/+page.svelte** (年度別詳細) (1時間)
   - 年度別詳細ページ

### 4.2 年度別データ対応
**所要時間**: 2-3時間  
**依存**: 年度別ルーティング  
**成果物**: 過年度データ取得ロジック

**タスク**:
- [ ] 2024年度データの変換・配置
- [ ] 2023年度データの変換・配置
- [ ] 年度別データ取得ロジック
- [ ] フォールバック処理の実装

## 6. フェーズ5: 最適化・テスト強化

### 6.1 パフォーマンス最適化
**所要時間**: 2-3時間  
**依存**: 全体実装完了  
**成果物**: 最適化されたサイト

**タスク**:
- [ ] 画像最適化（WebP/AVIF対応）
- [ ] バンドルサイズ確認・最適化
- [ ] Lighthouse スコア改善
- [ ] プリロード設定
- [ ] キャッシュ戦略の実装

### 6.2 テスト強化
**所要時間**: 3-4時間  
**依存**: 全体実装完了  
**成果物**: 包括的テストスイート

**タスク**:
- [ ] ルートテストの追加
- [ ] E2E テスト（Playwright）の検討
- [ ] アクセシビリティテストの強化
- [ ] パフォーマンステスト自動化

### 6.3 リリース準備
**所要時間**: 1-2時間  
**依存**: テスト強化  
**成果物**: リリース可能状態

**タスク**:
- [ ] vercel.json 設定（リダイレクト・ヘッダー）
- [ ] リリースチェックリスト実行
- [ ] ドキュメント最終更新
- [ ] デプロイ準備

## 7. 実装チェックリスト

### 7.1 各フェーズ共通チェック項目
- [x] TypeScript コンパイル成功
- [x] ESLint/Prettier チェック通過
- [x] 単体テスト実行・通過
- [x] ローカル環境での動作確認
- [x] git コミット・プッシュ

### 7.2 フェーズ完了時の総合チェック

#### フェーズ1完了時
- [x] Tailwind CSS が正常に動作
- [x] 新形式JSONファイルが生成されている
- [x] 型定義が正しく設定されている
- [x] データユーティリティが動作する

#### フェーズ2完了時
- [x] 全コンポーネントが Storybook/テストで確認済み
- [x] アクセシビリティ要件を満たしている
- [x] レスポンシブ対応が完了
- [x] デザイントークンが統一されている
- [x] Kanazawa Palette v2の完全実装
- [x] コンポーネントカタログページの作成
- [x] 線・境界線を削除したシンプルデザインへの変更
- [x] 全テストの実行・確認完了
- [x] TypeScriptコンパイルエラー０件達成

#### フェーズ3完了時
- [ ] 2025年版の全ページが動作
- [ ] データ取得・表示が正常
- [ ] SEO設定が適切
- [ ] プリレンダリングが機能

#### フェーズ4完了時
- [ ] 過年度ページが正常動作
- [ ] 年度間の導線が機能
- [ ] データの整合性が保たれている

#### フェーズ5完了時
- [ ] パフォーマンス目標を達成
- [ ] 全テストが通過
- [ ] リリースチェックリストクリア
- [ ] 本番デプロイ準備完了

## 8. リスク管理

### 高リスク項目
1. **データ移行の複雑さ**
   - 対策: 段階的移行、十分なテスト
2. **Carbon Components からの完全移行**
   - 対策: コンポーネント単位での段階的置換
3. **既存画像・リンクの整合性**
   - 対策: 移行スクリプトでの自動チェック

### 中リスク項目
1. **パフォーマンス劣化**
   - 対策: 各フェーズでの計測・最適化
2. **アクセシビリティ要件漏れ**
   - 対策: 各コンポーネントでのテスト強化

## 9. 推奨開発環境

### 必要ツール
- Node.js 20+
- npm または pnpm
- VS Code (推奨)
  - Svelte 拡張
  - Tailwind CSS IntelliSense
  - Prettier 拡張

### 開発フロー
```bash
# 開発サーバー起動
npm run dev

# ビルド確認
npm run build

# テスト実行
npm run test

# 型チェック
npm run check

# Lint & Format
npm run lint
npm run format
```

## 10. 完了目標

### 機能要件
- ✅ 2025年版サイトの完全動作
- ✅ 過年度ページの閲覧可能性
- ✅ データの正確な表示
- ✅ レスポンシブ対応

### 品質要件
- ✅ Lighthouse スコア 90+ (Performance, Accessibility, SEO)
- ✅ 初回JSバンドル 120KB以下 (gzip)
- ✅ LCP ≤ 2.5s (4G mobile)
- ✅ テストカバレッジ 80%+

### 運用要件
- ✅ Vercel での自動デプロイ
- ✅ プレビュー環境での動作確認
- ✅ 本番環境での安定稼働

---

**推定総開発時間**: 25-35時間  
**推定期間**: 1-2週間（1日4-6時間作業想定）